<html>
  <head>
    <title>kitchen sink</title>
    <script src="js/sheetengine-1.2.0.js"></script>
    <script src="js/pxloader-all.min.js"></script>
    <script type="text/javascript">
      var loader = new PxLoader();
      var purple = loader.addImage('images/texture.png');

      loader.addCompletionListener(function() {
        var canvasElement = document.getElementById('mainCanvas');
        sheetengine.scene.init(canvasElement, {w:2000,h:1500});

        var basesheet = new sheetengine.BaseSheet({x:0,y:0,z:0}, {alphaD:90,betaD:0,gammaD:0}, {w:256,h:256});
        basesheet.color = '#5D7E36';

        var sheet = new sheetengine.Sheet({x:0,y:0,z:10}, {alphaD:90,betaD:0,gammaD:0}, {w: 128,h: 128});
        // sheet.context.fillStyle = '#FFF';
        // sheet.context.fillRect(0,0,40,40);
        sheet.context.drawImage(purple, 0,0);
        sheet.onclick = function() {
          alert('foo');
        };

        canvasElement.onclick = function(event) {
          var coordsFromEvent = function(event) {
            var puv = {
              u:event.clientX - sheetengine.canvas.offsetLeft + pageXOffset,
              v:event.clientY - sheetengine.canvas.offsetTop + pageYOffset
            };
            var pxy = sheetengine.transforms.inverseTransformPoint({
              u:puv.u + sheetengine.scene.center.u,
              v:puv.v + sheetengine.scene.center.v
            });

            return pxy;
          };

          var overlap = function(obj, coords) {
            if (coords.x > obj.centerp.x - obj.width / 2
               && coords.x < obj.centerp.x + obj.width / 2
               && coords.y > obj.centerp.y - obj.height / 2
               && coords.y < obj.centerp.y + obj.height / 2) {
              return true;
            }
            return false;
          };

          var pxy = coordsFromEvent(event);
          console.log(pxy);

          if (overlap(sheet, pxy)) {
            console.log(pxy, sheetengine.drawing.getPointuv(sheet.centerp));
          }
        }

        sheetengine.calc.calculateAllSheets();

        sheetengine.drawing.drawScene(true);
      });

      loader.start();
    </script>
  </head>
  <body>
    <canvas id="mainCanvas" width="500" height="300"></canvas>
  </body>
</html>
